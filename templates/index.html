<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæµ·æŠ¥ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .main-content {
            min-height: calc(100vh - 40px);
            padding-bottom: 40px;
        }
        .footer {
            height: 40px;
            width: 100%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal img {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="main-content">
        <!-- é¡¶éƒ¨ä»‹ç»åŒºåŸŸ -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-12 mb-8">
            <div class="container mx-auto px-4">
                <h1 class="text-4xl font-bold text-center mb-4">AIæµ·æŠ¥ç”Ÿæˆå™¨</h1>
                <p class="text-xl text-center max-w-3xl mx-auto">
                    åŸºäºé˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ–‡ç”Ÿå›¾èƒ½åŠ›çš„æ™ºèƒ½æµ·æŠ¥ç”Ÿæˆå·¥å…·ï¼Œé›†æˆç¡…åŸºæµåŠ¨å¤§æ¨¡å‹ï¼Œå¿«é€Ÿç”Ÿæˆç²¾ç¾çš„è¥é”€æµ·æŠ¥ã€‚
                </p>
            </div>
        </div>

        <!-- åŠŸèƒ½ç‰¹ç‚¹å±•ç¤º -->
        <div class="container mx-auto px-4 mb-12">
            <h2 class="text-2xl font-bold text-center mb-8">åŠŸèƒ½ç‰¹ç‚¹</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="feature-card bg-white p-6 rounded-lg shadow">
                    <div class="text-3xl mb-4">ğŸ¤–</div>
                    <h3 class="font-bold mb-2">æ™ºèƒ½æ–‡æ¡ˆç”Ÿæˆ</h3>
                    <p class="text-gray-600 text-sm">åŸºäºç¡…åŸºæµåŠ¨ DeepSeek-V3 å¤§æ¨¡å‹ï¼Œä¸€é”®ç”Ÿæˆæ ‡é¢˜ã€å‰¯æ ‡é¢˜å’Œæ–‡æ¡ˆ</p>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow">
                    <div class="text-3xl mb-4">ğŸ¨</div>
                    <h3 class="font-bold mb-2">å¤šç§è‰ºæœ¯é£æ ¼</h3>
                    <p class="text-gray-600 text-sm">æ”¯æŒ2Dæ’ç”»ã€æµ©ç€šæ˜Ÿäº‘ã€ä¸­å›½æ°´å¢¨ã€å‰ªçº¸å·¥è‰ºç­‰å¤šç§é£æ ¼</p>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow">
                    <div class="text-3xl mb-4">ğŸ“</div>
                    <h3 class="font-bold mb-2">çµæ´»å°ºå¯¸æ¯”ä¾‹</h3>
                    <p class="text-gray-600 text-sm">æ”¯æŒæ¨ªç‰ˆå’Œç«–ç‰ˆæµ·æŠ¥ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚</p>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow">
                    <div class="text-3xl mb-4">âš¡</div>
                    <h3 class="font-bold mb-2">å®æ—¶çŠ¶æ€æ›´æ–°</h3>
                    <p class="text-gray-600 text-sm">æ˜¾ç¤ºç”Ÿæˆè¿›åº¦å’Œè€—æ—¶ï¼Œè®©æ‚¨äº†è§£æ¯ä¸€æ­¥</p>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦åŠŸèƒ½åŒºåŸŸ -->
        <div class="container mx-auto px-4">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- å·¦ä¾§ï¼šAIæç¤ºè¯ç”Ÿæˆ -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold mb-4">AIæç¤ºè¯ç”Ÿæˆ</h3>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">äº§å“æè¿°</label>
                            <textarea id="productDescription" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥äº§å“æè¿°ï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆåˆé€‚çš„æ–‡æ¡ˆ"></textarea>
                        </div>
                        <button id="generatePromptBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                            <span class="loading-spinner hidden">
                                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </span>
                            <span class="button-text">ç”Ÿæˆæç¤ºè¯</span>
                        </button>
                    </div>

                    <!-- å³ä¾§ï¼šæµ·æŠ¥å†…å®¹å¡«å†™ -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold mb-4">æµ·æŠ¥å†…å®¹</h3>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">æ ‡é¢˜ (æœ€å¤š30å­—)</label>
                            <input type="text" id="title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥æ ‡é¢˜">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">å‰¯æ ‡é¢˜ (æœ€å¤š30å­—)</label>
                            <input type="text" id="subtitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥å‰¯æ ‡é¢˜">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">æ­£æ–‡å†…å®¹ (æœ€å¤š50å­—)</label>
                            <textarea id="content" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥æ­£æ–‡å†…å®¹"></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">æç¤ºè¯ (æœ€å¤š50å­—)</label>
                            <input type="text" id="prompt" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è¯·è¾“å…¥æç¤ºè¯ï¼Œæè¿°æœŸæœ›çš„è‰ºæœ¯é£æ ¼">
                        </div>
                    </div>
                </div>

                <!-- æµ·æŠ¥æ ·å¼é€‰æ‹© -->
                <div class="mt-8 space-y-4">
                    <h3 class="text-lg font-semibold mb-4">æµ·æŠ¥æ ·å¼</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">å®½é«˜æ¯”</label>
                            <select id="ratio" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="æ¨ªç‰ˆ">æ¨ªç‰ˆ</option>
                                <option value="ç«–ç‰ˆ">ç«–ç‰ˆ</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">è‰ºæœ¯é£æ ¼</label>
                            <select id="style" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="2Dæ’ç”»1">2Dæ’ç”»1</option>
                                <option value="2Dæ’ç”»2">2Dæ’ç”»2</option>
                                <option value="æµ©ç€šæ˜Ÿäº‘">æµ©ç€šæ˜Ÿäº‘</option>
                                <option value="æµ“éƒè‰²å½©">æµ“éƒè‰²å½©</option>
                                <option value="å…‰çº¿ç²’å­">å…‰çº¿ç²’å­</option>
                                <option value="é€æ˜ç»ç’ƒ">é€æ˜ç»ç’ƒ</option>
                                <option value="å‰ªçº¸å·¥è‰º">å‰ªçº¸å·¥è‰º</option>
                                <option value="æŠ˜çº¸å·¥è‰º">æŠ˜çº¸å·¥è‰º</option>
                                <option value="ä¸­å›½æ°´å¢¨">ä¸­å›½æ°´å¢¨</option>
                                <option value="ä¸­å›½åˆºç»£">ä¸­å›½åˆºç»£</option>
                                <option value="çœŸå®åœºæ™¯">çœŸå®åœºæ™¯</option>
                                <option value="2Då¡é€š">2Då¡é€š</option>
                                <option value="å„¿ç«¥æ°´å½©">å„¿ç«¥æ°´å½©</option>
                                <option value="èµ›åšèƒŒæ™¯">èµ›åšèƒŒæ™¯</option>
                                <option value="æµ…è“æŠ½è±¡">æµ…è“æŠ½è±¡</option>
                                <option value="æ·±è“æŠ½è±¡">æ·±è“æŠ½è±¡</option>
                                <option value="æŠ½è±¡ç‚¹çº¿">æŠ½è±¡ç‚¹çº¿</option>
                                <option value="ç«¥è¯æ²¹ç”»">ç«¥è¯æ²¹ç”»</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- API Keyè¾“å…¥ï¼ˆå¯é€‰ï¼‰ -->
                <div class="mt-8">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">é˜¿é‡Œäº‘ API Keyï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="apiKey" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤key">
                    </div>
                </div>

                <!-- ç”ŸæˆæŒ‰é’® -->
                <div class="mt-8">
                    <button id="generatePosterBtn" type="button" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-md hover:from-blue-700 hover:to-indigo-700 transition-colors flex items-center justify-center space-x-2">
                        <span class="loading-spinner hidden">
                            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                        <span class="button-text">ç”Ÿæˆæµ·æŠ¥</span>
                    </button>
                </div>

                <!-- çŠ¶æ€æ˜¾ç¤º -->
                <div id="status" class="mt-6 text-center text-gray-600 hidden">
                    <div class="space-y-2">
                        <p id="pollCount">è½®è¯¢æ¬¡æ•°: 0</p>
                        <p id="elapsedTime">å·²ç”¨æ—¶é—´: 0ç§’</p>
                    </div>
                </div>

                <!-- ç»“æœå±•ç¤º -->
                <div id="result" class="mt-8 text-center">
                    <img id="posterImage" class="max-w-full mx-auto rounded-lg shadow-lg hidden" alt="ç”Ÿæˆçš„æµ·æŠ¥">
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <a href="https://github.com/koala9527/ai-poster" target="_blank" class="text-gray-400 text-xs flex items-center space-x-1 no-underline">
            <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
            </svg>
            <span>é¡¹ç›®åœ°å€</span>
        </a>
    </footer>

    <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="imageModal" class="modal hidden">
        <img id="modalImage" src="" alt="é¢„è§ˆå›¾ç‰‡">
    </div>

    <script>
        let startTime = null;
        let pollCount = 0;
        let pollInterval = null;
        let generatePromptTimeout = null;
        let generatePosterTimeout = null;

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // æ›´æ–°ç”Ÿæˆæç¤ºè¯æŒ‰é’®çŠ¶æ€
        function updateGeneratePromptButton(isLoading) {
            const button = document.getElementById('generatePromptBtn');
            const generateText = button.querySelector('.button-text');
            const loadingSpinner = button.querySelector('.loading-spinner');
            
            button.disabled = isLoading;
            if (isLoading) {
                generateText.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
            } else {
                generateText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        // æ›´æ–°ç”Ÿæˆæµ·æŠ¥æŒ‰é’®çŠ¶æ€
        function updateGeneratePosterButton(isLoading) {
            const button = document.getElementById('generatePosterBtn');
            const generateText = button.querySelector('.button-text');
            const loadingSpinner = button.querySelector('.loading-spinner');
            
            button.disabled = isLoading;
            if (isLoading) {
                generateText.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
            } else {
                generateText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        function updateElapsedTime() {
            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('elapsedTime').textContent = `å·²ç”¨æ—¶é—´: ${elapsed}ç§’`;
            }
        }

        function startPollingTimer() {
            startTime = Date.now();
            pollCount = 0;
            updateElapsedTime();
            pollInterval = setInterval(updateElapsedTime, 1000);
        }

        function stopPollingTimer() {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
        }

        // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        function showImagePreview(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = imageUrl;
            modal.classList.remove('hidden');
        }

        // å…³é—­é¢„è§ˆ
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // ç”Ÿæˆæµ·æŠ¥çš„ä¸»è¦å‡½æ•°
        const generatePoster = async () => {
            // ç›´æ¥ä»è¾“å…¥æ¡†è·å–å€¼
            const data = {
                title: document.getElementById('title').value.trim(),
                sub_title: document.getElementById('subtitle').value.trim(),
                body_text: document.getElementById('content').value.trim(),
                prompt_text_zh: document.getElementById('prompt').value.trim(),
                wh_ratios: document.getElementById('ratio').value,
                lora_name: document.getElementById('style').value
            };
            
            // å¦‚æœAPI Keyä¸ä¸ºç©ºï¼Œæ‰æ·»åŠ åˆ°è¯·æ±‚æ•°æ®ä¸­
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey) {
                data.api_key = apiKey;
            }
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            const requiredFields = ['title', 'sub_title', 'body_text', 'prompt_text_zh', 'wh_ratios', 'lora_name'];
            const missingFields = requiredFields.filter(field => !data[field]);
            
            if (missingFields.length > 0) {
                alert(`è¯·å¡«å†™ä»¥ä¸‹å¿…å¡«å­—æ®µï¼š${missingFields.join(', ')}`);
                return;
            }

            // éªŒè¯å­—æ®µé•¿åº¦
            if (data.title.length > 30) {
                alert('æ ‡é¢˜ä¸èƒ½è¶…è¿‡30ä¸ªå­—ç¬¦');
                return;
            }
            if (data.sub_title.length > 30) {
                alert('å‰¯æ ‡é¢˜ä¸èƒ½è¶…è¿‡30ä¸ªå­—ç¬¦');
                return;
            }
            if (data.body_text.length > 50) {
                alert('æ­£æ–‡å†…å®¹ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦');
                return;
            }
            if (data.prompt_text_zh.length > 50) {
                alert('æç¤ºè¯ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦');
                return;
            }
            
            // æ˜¾ç¤ºçŠ¶æ€
            document.getElementById('status').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');
            startPollingTimer();
            updateGeneratePosterButton(true);
            
            try {
                console.log('å‘é€çš„æ•°æ®:', data); // è°ƒè¯•ç”¨
                // å‘é€ç”Ÿæˆè¯·æ±‚
                const response = await axios.post('/generate', data, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.data.error) {
                    throw new Error(response.data.error);
                }
                
                const taskId = response.data.task_id;
                
                // å¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€
                pollTaskStatus(taskId);
            } catch (error) {
                console.error('Error:', error);
                let errorMessage = 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•';
                if (error.response) {
                    console.error('Error response:', error.response.data); // è°ƒè¯•ç”¨
                    errorMessage = error.response.data.detail || error.response.data.message || errorMessage;
                }
                alert(errorMessage);
                document.getElementById('status').classList.add('hidden');
                stopPollingTimer();
                updateGeneratePosterButton(false);
            }
        };

        // ä½¿ç”¨é˜²æŠ–åŒ…è£…ç”Ÿæˆæµ·æŠ¥å‡½æ•°
        const debouncedGeneratePoster = debounce(generatePoster, 500);

        // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('generatePosterBtn').addEventListener('click', debouncedGeneratePoster);

        async function pollTaskStatus(taskId) {
            try {
                const response = await axios.get(`/status/${taskId}`);
                
                if (response.data.error) {
                    throw new Error(response.data.error);
                }
                
                const status = response.data.status;
                pollCount++;
                document.getElementById('pollCount').textContent = `è½®è¯¢æ¬¡æ•°: ${pollCount}`;
                
                if (status === 'SUCCEEDED') {
                    // æ˜¾ç¤ºç»“æœ
                    document.getElementById('status').classList.add('hidden');
                    document.getElementById('result').classList.remove('hidden');
                    const posterImage = document.getElementById('posterImage');
                    posterImage.classList.remove('hidden');
                    stopPollingTimer();
                    updateGeneratePosterButton(false);
                    
                    // æ˜¾ç¤ºç”Ÿæˆçš„å›¾ç‰‡
                    if (response.data.result && response.data.result.image_url) {
                        posterImage.src = response.data.result.image_url;
                        posterImage.onclick = () => showImagePreview(response.data.result.image_url);
                    } else {
                        throw new Error('æœªè·å–åˆ°å›¾ç‰‡URL');
                    }
                } else if (status === 'FAILED') {
                    alert('ç”Ÿæˆå¤±è´¥ï¼š' + (response.data.error_message || 'æœªçŸ¥é”™è¯¯'));
                    document.getElementById('status').classList.add('hidden');
                    stopPollingTimer();
                    updateGeneratePosterButton(false);
                } else {
                    // ç»§ç»­è½®è¯¢
                    setTimeout(() => pollTaskStatus(taskId), 2000);
                }
            } catch (error) {
                console.error('Error polling status:', error);
                alert(error.response?.data?.error || error.message || 'è·å–çŠ¶æ€å¤±è´¥ï¼Œè¯·é‡è¯•');
                document.getElementById('status').classList.add('hidden');
                stopPollingTimer();
                updateGeneratePosterButton(false);
            }
        }

        // å­—ç¬¦é™åˆ¶å¤„ç†å‡½æ•°
        function truncateText(text, maxLength) {
            return text.length > maxLength ? text.substring(0, maxLength) : text;
        }

        // AIæç¤ºè¯ç”ŸæˆåŠŸèƒ½
        const generatePrompt = async () => {
            const aiPromptInput = document.getElementById('productDescription');
            const productDesc = aiPromptInput.value.trim();
            
            if (!productDesc) {
                alert('è¯·è¾“å…¥äº§å“æè¿°');
                return;
            }

            updateGeneratePromptButton(true);

            try {
                const response = await axios.post('/generate_prompt', {
                    product_desc: productDesc
                });

                if (response.data.error) {
                    throw new Error(response.data.error);
                }

                // ä½¿ç”¨æ­£ç¡®çš„IDè·å–è¾“å…¥æ¡†å…ƒç´ 
                document.getElementById('title').value = truncateText(response.data.title, 30);
                document.getElementById('subtitle').value = truncateText(response.data.sub_title, 30);
                document.getElementById('content').value = truncateText(response.data.body_text, 50);
                document.getElementById('prompt').value = truncateText(response.data.prompt_text_zh, 50);
            } catch (error) {
                console.error('Error:', error);
                alert(error.response?.data?.error || error.message || 'ç”Ÿæˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•');
            } finally {
                updateGeneratePromptButton(false);
            }
        };

        // ä½¿ç”¨é˜²æŠ–åŒ…è£…ç”Ÿæˆå‡½æ•°
        const debouncedGeneratePrompt = debounce(generatePrompt, 500);

        // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('generatePromptBtn').addEventListener('click', debouncedGeneratePrompt);
    </script>
</body>
</html> 